<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SlangLang // yeah nah programming</title>
    <meta name="description" content="SlangLang - a programming language that's had a few too many. Transpiles Aussie slang to JavaScript.">
    
    <!-- Fonts - monospace only, we're not fancy -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- CodeMirror -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <!-- CodeMirror Themes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/solarized-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/nord.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/gruvbox-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/one-dark.min.css">
    
    <style>
        /* Default theme - brutal */
        :root, [data-theme="brutal"] {
            --bg: #0a0a0a;
            --surface: #111;
            --border: #333;
            --text: #e0e0e0;
            --text-dim: #666;
            --accent: #ffcc00;
            --accent-dim: #997a00;
            --green: #00ff88;
            --red: #ff4444;
            --blue: #4488ff;
            --cm-theme: none;
        }
        
        /* Dracula */
        [data-theme="dracula"] {
            --bg: #282a36;
            --surface: #21222c;
            --border: #44475a;
            --text: #f8f8f2;
            --text-dim: #6272a4;
            --accent: #bd93f9;
            --accent-dim: #6c5ce7;
            --green: #50fa7b;
            --red: #ff5555;
            --blue: #8be9fd;
        }
        
        /* Nord */
        [data-theme="nord"] {
            --bg: #2e3440;
            --surface: #3b4252;
            --border: #4c566a;
            --text: #eceff4;
            --text-dim: #7b88a1;
            --accent: #88c0d0;
            --accent-dim: #5e81ac;
            --green: #a3be8c;
            --red: #bf616a;
            --blue: #81a1c1;
        }
        
        /* Gruvbox */
        [data-theme="gruvbox-dark"] {
            --bg: #282828;
            --surface: #1d2021;
            --border: #504945;
            --text: #ebdbb2;
            --text-dim: #928374;
            --accent: #fabd2f;
            --accent-dim: #d79921;
            --green: #b8bb26;
            --red: #fb4934;
            --blue: #83a598;
        }
        
        /* Monokai */
        [data-theme="monokai"] {
            --bg: #272822;
            --surface: #1e1f1c;
            --border: #49483e;
            --text: #f8f8f2;
            --text-dim: #75715e;
            --accent: #f92672;
            --accent-dim: #ae81ff;
            --green: #a6e22e;
            --red: #f92672;
            --blue: #66d9ef;
        }
        
        /* Solarized Dark */
        [data-theme="solarized-dark"] {
            --bg: #002b36;
            --surface: #073642;
            --border: #586e75;
            --text: #839496;
            --text-dim: #657b83;
            --accent: #b58900;
            --accent-dim: #cb4b16;
            --green: #859900;
            --red: #dc322f;
            --blue: #268bd2;
        }
        
        /* Material Darker */
        [data-theme="material-darker"] {
            --bg: #212121;
            --surface: #303030;
            --border: #424242;
            --text: #eeffff;
            --text-dim: #545454;
            --accent: #89ddff;
            --accent-dim: #82aaff;
            --green: #c3e88d;
            --red: #f07178;
            --blue: #82aaff;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'IBM Plex Mono', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
            font-size: 14px;
        }
        
        /* Header - minimal */
        header {
            border-bottom: 2px solid var(--border);
            padding: 1rem 1.5rem;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            text-decoration: none;
            color: var(--text);
        }
        
        .logo h1 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--accent);
        }
        
        .logo-tag {
            color: var(--text-dim);
            font-size: 0.8rem;
        }
        
        .rotating-phrases {
            display: inline-flex;
            position: relative;
            vertical-align: baseline;
            height: 1.25em;
            overflow: hidden;
            top: 0em;
        }
        
        .rotating-phrases span {
            display: block;
            line-height: 1.25;
            white-space: nowrap;
            position: absolute;
            left: 0;
            top: 0;
            animation: pushRotate 18s ease-in-out infinite;
            transform: translateY(100%);
        }
        
        /* Sizer is invisible, sets width */
        .rotating-phrases .sizer {
            position: relative;
            visibility: hidden;
            animation: none;
            transform: none;
        }
        
        .rotating-phrases span:nth-child(2) { animation-delay: 0s; }
        .rotating-phrases span:nth-child(3) { animation-delay: 3s; }
        .rotating-phrases span:nth-child(4) { animation-delay: 6s; }
        .rotating-phrases span:nth-child(5) { animation-delay: 9s; }
        .rotating-phrases span:nth-child(6) { animation-delay: 12s; }
        .rotating-phrases span:nth-child(7) { animation-delay: 15s; }
        
        @keyframes pushRotate {
            0% { transform: translateY(-100%); }
            2%, 14% { transform: translateY(0); }
            16.67%, 100% { transform: translateY(100%); }
        }
        
        .header-links a {
            color: var(--text-dim);
            text-decoration: none;
            padding: 0.4rem 0.8rem;
            border: 1px solid var(--border);
            font-size: 0.85rem;
            transition: all 0.1s;
        }
        
        .header-links a:hover {
            color: var(--text);
            border-color: var(--text);
        }
        
        /* Main Container */
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }
        
        /* Intro - dry and minimal */
        .intro {
            margin-bottom: 2rem;
            max-width: 600px;
        }
        
        .intro h2 {
            font-size: 1rem;
            font-weight: 500;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }
        
        .intro p {
            color: var(--text-dim);
            font-size: 0.9rem;
        }
        
        .intro .disclaimer {
            margin-top: 1rem;
            padding: 0.75rem;
            border-left: 2px solid var(--accent-dim);
            color: var(--text-dim);
            font-size: 0.8rem;
        }
        
        /* Presets - brutalist buttons */
        .presets-bar {
            display: flex;
            gap: 0;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            border: 2px solid var(--border);
            width: fit-content;
        }
        
        .preset-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-right: 1px solid var(--border);
            background: transparent;
            color: var(--text-dim);
            cursor: pointer;
            font-family: inherit;
            font-size: 0.85rem;
            transition: all 0.1s;
        }
        
        .preset-btn:last-child {
            border-right: none;
        }
        
        .preset-btn:hover {
            background: var(--surface);
            color: var(--text);
        }
        
        .preset-btn.active {
            background: var(--accent);
            color: var(--bg);
        }
        
        /* Editor Layout */
        .playground {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            border: 2px solid var(--border);
        }
        
        @media (max-width: 800px) {
            .playground {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: var(--surface);
        }
        
        .panel:first-child {
            border-right: 2px solid var(--border);
        }
        
        @media (max-width: 800px) {
            .panel:first-child {
                border-right: none;
                border-bottom: 2px solid var(--border);
            }
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
        }
        
        .panel-title {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .run-btn {
            padding: 0.4rem 1rem;
            background: var(--green);
            color: var(--bg);
            border: none;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.1s;
        }
        
        .run-btn:hover {
            filter: brightness(1.1);
        }
        
        .run-btn:active {
            filter: brightness(0.9);
        }
        
        /* CodeMirror - raw terminal vibes */
        .CodeMirror {
            height: 400px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            border: none;
        }
        
        .CodeMirror-gutters {
            border-right: 1px solid var(--border);
        }
        
        .CodeMirror-linenumber {
            color: var(--text-dim);
        }
        
        .CodeMirror-cursor {
            border-left: 2px solid var(--accent);
        }
        
        /* Custom syntax highlighting for brutal theme (no CodeMirror theme) */
        [data-theme="brutal"] .cm-keyword { color: var(--accent); font-weight: 500; }
        [data-theme="brutal"] .cm-builtin { color: var(--green); font-weight: 500; }
        [data-theme="brutal"] .cm-string { color: #ff9966; }
        [data-theme="brutal"] .cm-number { color: var(--blue); }
        [data-theme="brutal"] .cm-variable { color: var(--text); }
        [data-theme="brutal"] .cm-comment { color: var(--text-dim); }
        [data-theme="brutal"] .cm-punctuation { color: var(--accent); }
        
        [data-theme="brutal"] .CodeMirror {
            background: var(--bg);
            color: var(--text);
        }
        
        [data-theme="brutal"] .CodeMirror-gutters {
            background: var(--bg);
        }
        
        /* Theme selector */
        .theme-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .theme-selector label {
            font-size: 0.7rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .theme-selector select {
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: inherit;
            font-size: 0.75rem;
            padding: 0.2rem 0.5rem;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.3rem center;
            padding-right: 1.5rem;
        }
        
        .theme-selector select:hover {
            border-color: var(--text);
        }
        
        .theme-selector select:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        /* Output */
        .output {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            padding: 1rem;
            min-height: 400px;
            max-height: 400px;
            overflow-y: auto;
            background: var(--bg);
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .output.error {
            color: var(--red);
        }
        
        .output.success {
            color: var(--green);
        }
        
        .output-placeholder {
            color: var(--text-dim);
            display: block;
        }
        
        /* JS Output */
        .js-output {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            padding: 1rem;
            background: var(--bg);
            color: var(--text-dim);
            min-height: 400px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        /* Tabs */
        .output-tabs {
            display: flex;
            gap: 0;
        }
        
        .output-tab {
            padding: 0.4rem 0.75rem;
            background: transparent;
            border: none;
            color: var(--text-dim);
            cursor: pointer;
            font-family: inherit;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid transparent;
            transition: all 0.1s;
        }
        
        .output-tab:hover {
            color: var(--text);
        }
        
        .output-tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }
        
        .output-content {
            display: none;
        }
        
        .output-content.active {
            display: block;
        }
        
        /* Footer - minimal */
        footer {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 2rem;
        }
        
        .footer-left {
            color: var(--text-dim);
            font-size: 0.8rem;
            max-width: 400px;
        }
        
        .footer-left p {
            margin-bottom: 0.5rem;
        }
        
        .footer-links {
            display: flex;
            gap: 1.5rem;
        }
        
        .footer-links a {
            color: var(--text-dim);
            text-decoration: none;
            font-size: 0.8rem;
        }
        
        .footer-links a:hover {
            color: var(--accent);
        }
        
        /* Scrollbar - minimal */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-dim);
        }
        
        /* Keyboard hint */
        .kbd {
            display: inline-block;
            padding: 0.1rem 0.4rem;
            background: var(--surface);
            border: 1px solid var(--border);
            font-size: 0.75rem;
            color: var(--text-dim);
        }
        
        /* Quick Reference Panel */
        .quickref {
            margin-top: 1.5rem;
            border: 2px solid var(--border);
        }
        
        .quickref-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0.75rem;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            user-select: none;
        }
        
        .quickref-header:hover {
            background: var(--surface);
        }
        
        .quickref-title {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .quickref-toggle {
            color: var(--text-dim);
            font-size: 0.8rem;
        }
        
        .quickref-content {
            display: none;
            background: var(--surface);
            max-height: 300px;
            overflow-y: auto;
        }
        
        .quickref.open .quickref-content {
            display: block;
        }
        
        .quickref.open .quickref-toggle::after {
            content: '‚ñ≤';
        }
        
        .quickref-toggle::after {
            content: '‚ñº';
        }
        
        .quickref-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 0;
        }
        
        .quickref-section {
            padding: 0.75rem 1rem;
            border-right: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }
        
        .quickref-section:last-child {
            border-right: none;
        }
        
        .quickref-section h4 {
            font-size: 0.7rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        
        .quickref-item {
            margin-bottom: 0.4rem;
            font-size: 0.8rem;
            line-height: 1.4;
        }
        
        .quickref-item code {
            color: var(--green);
            background: var(--bg);
            padding: 0.1rem 0.3rem;
            font-size: 0.75rem;
        }
        
        .quickref-item .arrow {
            color: var(--text-dim);
            margin: 0 0.3rem;
        }
        
        .quickref-item .desc {
            color: var(--text-dim);
        }
        
        .quickref-table {
            width: 100%;
            font-size: 0.75rem;
            border-collapse: collapse;
        }
        
        .quickref-table td {
            padding: 0.2rem 0;
        }
        
        .quickref-table td:first-child {
            color: var(--green);
            width: 40%;
        }
        
        .quickref-table td:last-child {
            color: var(--text-dim);
        }
        
        @media (max-width: 800px) {
            .quickref-grid {
                grid-template-columns: 1fr;
            }
            .quickref-section {
                border-right: none;
            }
        }

        /* AI Code Generator */
        .ai-generator {
            margin-bottom: 1.5rem;
            border: 2px solid var(--border);
            background: var(--surface);
        }

        .ai-generator-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
        }

        .ai-generator-title {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .ai-auth-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .auth-status-text {
            font-size: 0.7rem;
            color: var(--text-dim);
        }

        .auth-btn, .generate-btn {
            padding: 0.4rem 0.8rem;
            background: var(--blue);
            color: var(--bg);
            border: none;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.1s;
            border-radius: 2px;
        }

        .auth-btn:hover, .generate-btn:hover {
            filter: brightness(1.1);
        }

        .auth-btn:active, .generate-btn:active {
            filter: brightness(0.9);
        }

        .auth-btn:disabled, .generate-btn:disabled {
            background: var(--text-dim);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .ai-generator-content {
            padding: 0.75rem;
        }

        .ai-input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .ai-prompt-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: inherit;
            font-size: 0.85rem;
            border-radius: 2px;
        }

        .ai-prompt-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .ai-prompt-input:disabled {
            background: var(--surface);
            color: var(--text-dim);
            cursor: not-allowed;
        }

        .ai-example-hint {
            color: var(--text-dim);
            font-size: 0.75rem;
        }

        .ai-loading {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ai-spinner {
            width: 12px;
            height: 12px;
            border: 2px solid var(--border);
            border-top: 2px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            animation: fadeIn 0.2s ease-out;
        }

        .modal-overlay.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 4px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.2s ease-out;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem 1.5rem 1rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h3 {
            margin: 0;
            color: var(--accent);
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-dim);
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--text);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-body p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .modal-body ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .modal-body li {
            margin-bottom: 0.5rem;
        }

        .modal-footer {
            display: flex;
            gap: 0.75rem;
            padding: 1rem 1.5rem 1.5rem;
            border-top: 1px solid var(--border);
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text);
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: 4px;
            transition: all 0.1s;
        }

        .modal-btn:hover {
            border-color: var(--text);
        }

        .modal-btn-primary {
            background: var(--blue);
            color: white;
            border-color: var(--blue);
        }

        .modal-btn-primary:hover {
            filter: brightness(1.1);
        }

        .modal-btn-secondary {
            color: var(--text-dim);
        }

        .modal-btn-secondary:hover {
            background: var(--surface);
            color: var(--text);
        }

        .github-icon {
            margin-right: 0.5rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* User Avatar */
        .user-avatar {
            position: relative;
            margin-left: 0.5rem;
            cursor: pointer;
        }

        .user-avatar-img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--border);
            transition: border-color 0.1s;
        }

        .user-avatar:hover .user-avatar-img {
            border-color: var(--text);
        }

        .user-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            min-width: 120px;
            z-index: 100;
            display: none;
        }

        .user-avatar:hover .user-menu {
            display: block;
        }

        .user-menu-item {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            color: var(--text);
            text-align: left;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.1s;
        }

        .user-menu-item:hover {
            background: var(--border);
        }

        @media (max-width: 600px) {
            .modal-content {
                width: 95%;
                margin: 1rem;
            }

            .modal-footer {
                flex-direction: column-reverse;
            }

            .modal-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
  <header>
    <div class="header-content">
      <a href="#" class="logo">
        <h1>SlangLang</h1>
        <span class="logo-tag">// v0.2.0 - probably buggy</span>
      </a>
      <div class="header-links">
        <a href="https://github.com/in03/slanglang" target="_blank" rel="noopener">src</a>
      </div>
    </div>
  </header>

  <main>
    <section class="intro">
      <h2>yeah nah, it's a programming language</h2>
      <p>Slanglang is a quirky <a href="https://esolangs.org/wiki/Main_Page" target="_blank" rel="noopener">esolang</a> that reads like your mate who's had one too many and writes about the same.</p>
      <div class="disclaimer">
        ‚ö†Ô∏è In all seriousness, you probably shouldn't use this for anything important.
      </div>
    </section>

    <div class="presets-bar">
      <button class="preset-btn active" data-preset="hello">hello world</button>
      <button class="preset-btn" data-preset="loops">loops</button>
      <button class="preset-btn" data-preset="functions">functions</button>
      <button class="preset-btn" data-preset="data">data</button>
      <button class="preset-btn" data-preset="conditions">conditions</button>
    </div>

    <!-- AI Code Generator -->
    <div class="ai-generator">
      <div class="ai-generator-header">
        <span class="ai-generator-title">AI Code Generator</span>
        <div class="ai-auth-status" style="display: none;">
          <span id="authStatus" class="auth-status-text">Not authenticated</span>
          <button id="authBtn" class="auth-btn" type="button">Login with GitHub</button>
        </div>
      </div>
      <div class="ai-generator-content">
        <div class="ai-input-group">
          <input type="text" id="aiPrompt" class="ai-prompt-input" placeholder="e.g. calculate fibonacci numbers" disabled>
          <button id="generateBtn" class="generate-btn" type="button" disabled>Send It</button>
          <div id="userAvatar" class="user-avatar" style="display: none;">
            <img id="userAvatarImg" class="user-avatar-img" src="" alt="User avatar">
            <div id="userMenu" class="user-menu">
              <button id="signOutBtn" class="user-menu-item" type="button">Sign Out</button>
            </div>
          </div>
        </div>
        <div class="ai-example-hint">
          <small>Uses GitHub models for inference</small>
        </div>
      </div>
    </div>

    <!-- GitHub Auth Modal -->
    <div id="authModal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ü§ñ GitHub Models Access</h3>
          <button id="closeModal" class="modal-close" type="button">&times;</button>
        </div>
        <div class="modal-body">
          <p>To use the AI code generator powered by GitHub Models, you'll need to sign in with your GitHub account.</p>
          <p><strong>What you'll get:</strong></p>
          <ul>
            <li>Generate custom SlangLang code examples</li>
            <li>AI-powered assistance with syntax and patterns</li>
            <li>Context-aware code generation using the language spec</li>
          </ul>
          <p><small>This uses GitHub's OAuth and requires minimal permissions for AI model access.</small></p>
        </div>
        <div class="modal-footer">
          <button id="cancelAuth" class="modal-btn modal-btn-secondary" type="button">Maybe Later</button>
          <button id="confirmAuth" class="modal-btn modal-btn-primary" type="button">
            <span class="github-icon">üêô</span>
            Sign in with GitHub
          </button>
        </div>
      </div>
    </div>

    <div class="playground">
      <div class="panel">
        <div class="panel-header">
          <div style="display: flex; align-items: center; gap: 1rem;">
            <span class="panel-title">input.slang</span>
            <div class="theme-selector">
              <label for="themeSelect">theme</label>
              <select id="themeSelect">
                <option value="brutal" selected>brutal</option>
                <option value="dracula">dracula</option>
                <option value="nord">nord</option>
                <option value="gruvbox-dark">gruvbox</option>
                <option value="monokai">monokai</option>
                <option value="solarized-dark">solarized</option>
                <option value="material-darker">material</option>
              </select>
            </div>
          </div>
          <button class="run-btn" id="runBtn">run</button>
        </div>
        <div class="editor-wrapper">
          <textarea id="editor"></textarea>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">output</span>
          <div class="output-tabs">
            <button class="output-tab active" data-tab="output">stdout</button>
            <button class="output-tab" data-tab="js">transpiled.js</button>
          </div>
        </div>
        <div id="outputPanel" class="output-content active">
          <div id="output" class="output">
            <span class="output-placeholder">// hit run or press <span class="kbd">ctrl</span>+<span class="kbd">enter</span></span>
          </div>
        </div>
        <div id="jsPanel" class="output-content">
          <pre id="jsOutput" class="js-output">// the javascript goes here
// it's probably a lot easier to read</pre>
        </div>
      </div>
    </div>

    <!-- Quick Reference -->
    <div class="quickref open" id="quickref">
      <div class="quickref-header" onclick="document.getElementById('quickref').classList.toggle('open')">
        <span class="quickref-title">quick ref // the weird bits</span>
        <span class="quickref-toggle"></span>
      </div>
      <div class="quickref-content">
        <div class="quickref-grid">
          
          <div class="quickref-section">
            <h4>strings (the fun way)</h4>
            <div class="quickref-item">
              <code>bloody Bruce mate</code><span class="arrow">‚Üí</span><span class="desc">"Bruce"</span>
            </div>
            <div class="quickref-item">
              <code>"also works"</code><span class="arrow">‚Üí</span><span class="desc">normal quotes too</span>
            </div>
          </div>

          <div class="quickref-section">
            <h4>numbers (cooked)</h4>
            <div class="quickref-item">
              <code>flamin ripper</code><span class="arrow">‚Üí</span><span class="desc">6 (word length!)</span>
            </div>
            <div class="quickref-item">
              <code>frothin 3.14</code><span class="arrow">‚Üí</span><span class="desc">3.14 (float)</span>
            </div>
            <div class="quickref-item">
              <code>42</code><span class="arrow">‚Üí</span><span class="desc">just a number</span>
            </div>
          </div>

          <div class="quickref-section">
            <h4>functions</h4>
            <div class="quickref-item">
              <code>x on the barbie:</code><span class="arrow">‚Üí</span><span class="desc">define func</span>
            </div>
            <div class="quickref-item">
              <code>... with a, b:</code><span class="arrow">‚Üí</span><span class="desc">with params</span>
            </div>
            <div class="quickref-item">
              <code>serve x plus y</code><span class="arrow">‚Üí</span><span class="desc">return value</span>
            </div>
            <div class="quickref-item">
              <code>howbout x with "y"</code><span class="arrow">‚Üí</span><span class="desc">call func</span>
            </div>
          </div>

          <div class="quickref-section">
            <h4>comments</h4>
            <div class="quickref-item">
              <code>oi this is ignored</code><span class="arrow">‚Üí</span><span class="desc">line comment</span>
            </div>
            <div class="quickref-item">
              <code>aussie aussie aussie</code><span class="arrow">‚Üí</span><span class="desc">block start</span>
            </div>
            <div class="quickref-item">
              <code>oi oi oi</code><span class="arrow">‚Üí</span><span class="desc">block end</span>
            </div>
          </div>

          <div class="quickref-section">
            <h4>data structures</h4>
            <div class="quickref-item">
              <code>esky: bloody string, flamin 3.</code><span class="arrow">‚Üí</span><span class="desc">list</span>
            </div>
            <div class="quickref-item">
              <code>tuckshop: x is 1, y is 2.</code><span class="arrow">‚Üí</span><span class="desc">dict</span>
            </div>
            <div class="quickref-item">
              <code>scoffin item from list!</code><span class="arrow">‚Üí</span><span class="desc">for each</span>
            </div>
            <div class="quickref-item">
              <code>pass the i, 10!</code><span class="arrow">‚Üí</span><span class="desc">for i in range(10)</span>
            </div>
          </div>

          <div class="quickref-section">
            <h4>primitives</h4>
            <table class="quickref-table">
              <tr><td>yeah</td><td>true</td></tr>
              <tr><td>nah</td><td>false</td></tr>
              <tr><td>nothin</td><td>null</td></tr>
              <tr><td>tops</td><td>&gt; (greater than)</td></tr>
              <tr><td>cops</td><td>&lt; (less than)</td></tr>
              <tr><td>is</td><td>= (assignment)</td></tr>
            </table>
          </div>

        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-left">
        <p>made for kicks and giggles ü¶µü§≠</p>
        <p>by <a href="https://calebtrevatt.com" target="_blank">@caleb.trevatt</a></p>
      </div>
      <div class="footer-links">
        <a href="https://github.com/in03/slanglang" target="_blank">github</a>
        <a href="https://github.com/in03/slanglang/blob/main/spec.md" target="_blank">spec</a>
        <a href="https://github.com/in03/slanglang/issues" target="_blank">complain</a>
      </div>
    </div>
  </footer>

  <!-- Configuration -->
  <script src="config.js"></script>

  <!-- SlangLang Compiler Bundle -->
  <script src="slanglang.bundle.js"></script>
  
  <script>
    // SlangLang syntax highlighting mode for CodeMirror
    CodeMirror.defineMode("slanglang", function() {
      // Keywords are auto-generated from lexer.js at build time
      const keywords = new Set([]); // PLACEHOLDER - replaced by build.js
      
      const builtins = new Set(["Crikey", "crikey"]);
      
      return {
        startState: function() {
          return { inString: false, inBlockComment: false, stringWordCount: 0 };
        },
        token: function(stream, state) {
          // Block comment
          if (state.inBlockComment) {
            if (stream.match(/oi\s+oi\s+oi/i)) {
              state.inBlockComment = false;
              return "comment";
            }
            stream.next();
            return "comment";
          }
          
          // Check for block comment start
          if (stream.match(/aussie\s+aussie\s+aussie/i)) {
            state.inBlockComment = true;
            return "comment";
          }
          
          // Line comment (oi followed by space, but not oi oi oi)
          if (stream.match(/oi(?!\s+oi)\s/i)) {
            stream.skipToEnd();
            return "comment";
          }
          
          // Skip whitespace
          if (stream.match(/\s+/)) {
            return null;
          }
          
          // Bloody string handling
          if (stream.match(/bloody\b/i)) {
            state.inString = true;
            state.stringWordCount = 0;
            return "keyword";
          }
          
          if (state.inString) {
            if (stream.match(/mate\b/i)) {
              state.inString = false;
              return "keyword";
            }
            
            if (state.stringWordCount >= 1 && stream.match(/[,\.!\?\n]/)) {
              state.inString = false;
              return "punctuation";
            }
            
            if (stream.match(/[a-zA-Z_][a-zA-Z0-9_']*/)) {
              state.stringWordCount++;
              return "string";
            }
            
            stream.next();
            return "string";
          }
          
          // Quoted string
          if (stream.match(/"[^"]*"/)) {
            return "string";
          }
          
          // Numbers
          if (stream.match(/-?\d+(\.\d+)?/)) {
            return "number";
          }
          
          // Punctuation
          if (stream.match(/[,:\.!\?‚Äì]/)) {
            return "punctuation";
          }
          
          // Words
          if (stream.match(/[a-zA-Z_][a-zA-Z0-9_']*/)) {
            const word = stream.current().toLowerCase().replace(/'/g, "'");
            if (builtins.has(stream.current())) return "builtin";
            if (keywords.has(word)) return "keyword";
            return "variable";
          }
          
          stream.next();
          return null;
        }
      };
    });
  </script>
  
  <script>
    // Example presets
    const presets = {
      hello: `oi this is a comment. g'day.

oi 'bloody ... mate' string literals
Crikey! bloody g'day mate.

oi yeah we do double quotes too
Crikey! "That's not a program, *this* is a program."

oi method chaining? bloody oath
suggestion is bloody hands off my pie mate
chippyslap is suggestion then to upper case
Crikey! chippyslap`,
                
                loops: `oi looping through a list

sangas is esky: bloody ham, bloody cheese, bloody salad.

Crikey! bloody What's in the esky? mate.
scoffin snag from sangas!
  Crikey! snag
who's full?

oi range loop
Crikey! bloody Counting: mate.
pass the parcel, 5!
  Crikey! parcel
who's got it?`,
                
                functions: `oi functions go on the barbie

shrimp on the barbie with oldmate:
  Crikey! "Careful! " plus oldmate plus ", it's hot!" oi syntax is yuck
  serve yeah
fair go.

add on the barbie with a, b:
  serve a plus b
fair go.

oi call em
howbout shrimp with "sheila"

result is howbout add with 10, 5
Crikey! "10 + 5 ="
Crikey! result`,
                
                data: `oi esky = list, tuckshop = dict

goodies is esky: bloody beer, bloody chips, bloody snags.
Crikey! "In the esky:"
Crikey! goodies

menu is tuckshop: pies is 5, sauce is bloody tomato mate, drinks is 3.
Crikey! bloody Menu: Mate.
Crikey! menu

oi iterate the dict
Crikey! "Items:"
dealin from menu!
  Crikey! item
  Crikey! price
who's full?`,
                
                conditions: `oi conditionals

score is 85

if score tops 90,
  Crikey! "Ripper! Top marks!"
or if score tops 70,
  Crikey! "Not bad mate"
or if score tops 50,
  Crikey! "She'll be right"
otherwise,
  Crikey! "Yeah nah"
make tracks.

oi another one
age is 21
if age tops 17,
  Crikey! "Can drink"
make tracks.`
            };
            
            // Theme handling
            const savedTheme = localStorage.getItem('slanglang-theme') || 'brutal';
            
            // Apply site theme immediately (before editor exists)
            document.body.setAttribute('data-theme', savedTheme);
            
            function applyTheme(theme) {
                // Set site theme via data attribute
                document.body.setAttribute('data-theme', theme);
                
                // Set CodeMirror theme (brutal uses our custom CSS, others use CM themes)
                const cmTheme = theme === 'brutal' ? '' : theme;
                if (editor) {
                    editor.setOption('theme', cmTheme);
                }
            }
            
            // Initialize CodeMirror
            const cmTheme = savedTheme === 'brutal' ? '' : savedTheme;
            const editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
                mode: 'slanglang',
                lineNumbers: true,
                lineWrapping: true,
                tabSize: 2,
                indentWithTabs: false,
                styleActiveLine: true,
                theme: cmTheme,
            });
            
            // Load default preset
            editor.setValue(presets.hello);
            
            // Theme selector
            const themeSelect = document.getElementById('themeSelect');
            themeSelect.value = savedTheme;
            
            themeSelect.addEventListener('change', (e) => {
                const theme = e.target.value;
                applyTheme(theme);
                localStorage.setItem('slanglang-theme', theme);
            });
            
            // Preset buttons
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    editor.setValue(presets[btn.dataset.preset]);
                    document.getElementById('output').innerHTML = '<span class="output-placeholder">// hit run or press <span class="kbd">ctrl</span>+<span class="kbd">enter</span></span>';
                    document.getElementById('jsOutput').textContent = '// the javascript goes here\n// it\'s probably not pretty';
                });
            });
            
            // Tab switching
            document.querySelectorAll('.output-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.output-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.output-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab + 'Panel').classList.add('active');
                });
            });
            
            // Run button
            document.getElementById('runBtn').addEventListener('click', () => {
                const code = editor.getValue();
                const outputEl = document.getElementById('output');
                const jsOutputEl = document.getElementById('jsOutput');
                
                try {
                    const result = window.SlangLang.run(code);
                    outputEl.className = 'output success';
                    outputEl.textContent = result.output || '// no output';
                    jsOutputEl.textContent = result.js;
                } catch (err) {
                    outputEl.className = 'output error';
                    outputEl.textContent = '// error: ' + err.message;
                    jsOutputEl.textContent = '// compilation failed\n// ' + err.message;
                }
            });
            
            // Keyboard shortcut
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('runBtn').click();
                }
            });

            // AI Code Generator
            class AIGenerator {
                constructor() {
                    this.githubToken = null;
                    this.specContent = null;
                    this.isAuthenticated = false;
                    this.clientId = null; // Will be set from environment or config
                    this.pendingPrompt = null; // Store prompt when showing auth modal

                    this.init();
                }

                async init() {
                    // Load spec.md content
                    await this.loadSpecContent();

                    // Setup UI event listeners
                    this.setupEventListeners();

                    // Check if we have stored auth
                    this.checkStoredAuth();

                    // Check for OAuth callback
                    this.handleOAuthCallback();

                    // Initialize UI state (enable prompt/button if not authenticated)
                    this.updateAuthUI();
                }

                async loadSpecContent() {
                    try {
                        const response = await fetch('./spec.md');
                        if (response.ok) {
                            this.specContent = await response.text();
                        } else {
                            console.warn('Could not load spec.md');
                        }
                    } catch (error) {
                        console.warn('Error loading spec.md:', error);
                    }
                }

                setupEventListeners() {
                    const authBtn = document.getElementById('authBtn');
                    const generateBtn = document.getElementById('generateBtn');
                    const promptInput = document.getElementById('aiPrompt');
                    const modal = document.getElementById('authModal');
                    const closeModal = document.getElementById('closeModal');
                    const cancelAuth = document.getElementById('cancelAuth');
                    const confirmAuth = document.getElementById('confirmAuth');
                    const signOutBtn = document.getElementById('signOutBtn');

                    authBtn.addEventListener('click', () => this.showAuthModal());
                    signOutBtn.addEventListener('click', () => this.signOut());
                    generateBtn.addEventListener('click', () => {
                        const isDevMode = window.SlangLangConfig?.DEV_MODE;
                        const isLocalDev = window.location.protocol === 'file:' ||
                                         window.location.hostname === 'localhost' ||
                                         window.location.hostname === '127.0.0.1';

                        if (isDevMode || isLocalDev) {
                            // Development mode - allow generation without auth
                            this.generateCode();
                        } else if (!this.isAuthenticated) {
                            this.showAuthModal();
                        } else {
                            this.generateCode();
                        }
                    });
                    promptInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            const isDevMode = window.SlangLangConfig?.DEV_MODE;
                            const isLocalDev = window.location.protocol === 'file:' ||
                                             window.location.hostname === 'localhost' ||
                                             window.location.hostname === '127.0.0.1';

                            if (isDevMode || isLocalDev) {
                                this.generateCode();
                            } else if (!this.isAuthenticated) {
                                this.showAuthModal();
                            } else {
                                this.generateCode();
                            }
                        }
                    });

                    // Modal event listeners
                    closeModal.addEventListener('click', () => this.hideAuthModal());
                    cancelAuth.addEventListener('click', () => this.hideAuthModal());
                    confirmAuth.addEventListener('click', () => {
                        this.hideAuthModal();
                        this.authenticateWithGitHub();
                    });

                    // Close modal when clicking overlay
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.hideAuthModal();
                        }
                    });
                }

                showAuthModal() {
                    // Store the current prompt before showing auth modal
                    const promptInput = document.getElementById('aiPrompt');
                    this.pendingPrompt = promptInput.value.trim();
                    document.getElementById('authModal').classList.add('show');
                }

                hideAuthModal() {
                    document.getElementById('authModal').classList.remove('show');
                }

                checkStoredAuth() {
                    const token = localStorage.getItem('slanglang-github-token');
                    const tokenExpiry = localStorage.getItem('slanglang-github-token-expiry');

                    if (token && tokenExpiry) {
                        const now = Date.now();
                        if (now < parseInt(tokenExpiry)) {
                            this.githubToken = token;
                            this.isAuthenticated = true;
                            this.updateAuthUI();
                        } else {
                            // Token expired, clear it
                            localStorage.removeItem('slanglang-github-token');
                            localStorage.removeItem('slanglang-github-token-expiry');
                        }
                    }
                }

                handleOAuthCallback() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const code = urlParams.get('code');
                    const state = urlParams.get('state');

                    if (code && state) {
                        // Verify state to prevent CSRF
                        const storedState = sessionStorage.getItem('oauth-state');
                        if (state !== storedState) {
                            console.error('OAuth state mismatch');
                            return;
                        }

                        // Clear the state
                        sessionStorage.removeItem('oauth-state');

                        // Exchange code for token
                        this.exchangeCodeForToken(code);

                        // Clean up URL
                        const url = new URL(window.location);
                        url.searchParams.delete('code');
                        url.searchParams.delete('state');
                        window.history.replaceState({}, '', url);
                    }
                }

                async authenticateWithGitHub() {
                    // Get client ID from config
                    this.clientId = window.SlangLangConfig?.GITHUB_CLIENT_ID;

                    if (!this.clientId || this.clientId === 'your-github-oauth-app-client-id') {
                        alert('GitHub OAuth not configured. Please update config.js with your GitHub OAuth App Client ID.\n\nCreate an OAuth app at: https://github.com/settings/applications/new');
                        return;
                    }

                    // Check if running locally (file:// or localhost)
                    const isLocalDev = window.location.protocol === 'file:' ||
                                     window.location.hostname === 'localhost' ||
                                     window.location.hostname === '127.0.0.1';

                    if (isLocalDev) {
                        alert('Local development detected. For OAuth testing, please:\n\n1. Serve files via HTTP server (not file://)\n2. Use HTTPS for production OAuth\n3. Or deploy to test OAuth flow\n\nFor local testing, consider using ngrok or similar tunneling service.');
                        return;
                    }

                    // Use current path for redirect URI (GitHub OAuth app should be configured to allow this URL)
                    const redirectUri = window.location.origin + window.location.pathname;
                    const scope = 'read:user';

                    // Generate PKCE code verifier and challenge
                    const codeVerifier = this.generateCodeVerifier();
                    const codeChallenge = await this.generateCodeChallenge(codeVerifier);

                    // Store code verifier for later
                    sessionStorage.setItem('pkce-code-verifier', codeVerifier);

                    // Generate state for CSRF protection
                    const state = this.generateState();
                    sessionStorage.setItem('oauth-state', state);

                    // Build OAuth URL
                    const authUrl = new URL('https://github.com/login/oauth/authorize');
                    authUrl.searchParams.set('client_id', this.clientId);
                    authUrl.searchParams.set('redirect_uri', redirectUri);
                    authUrl.searchParams.set('scope', scope);
                    authUrl.searchParams.set('state', state);
                    authUrl.searchParams.set('code_challenge', codeChallenge);
                    authUrl.searchParams.set('code_challenge_method', 'S256');

                    // Redirect to GitHub
                    window.location.href = authUrl.toString();
                }

                async exchangeCodeForToken(code) {
                    if (!this.clientId) return;

                    const codeVerifier = sessionStorage.getItem('pkce-code-verifier');
                    if (!codeVerifier) {
                        console.error('No code verifier found');
                        return;
                    }

                    // Clear the verifier
                    sessionStorage.removeItem('pkce-code-verifier');

                    try {
                        const response = await fetch('https://github.com/login/oauth/access_token', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                                'Accept': 'application/json'
                            },
                            body: new URLSearchParams({
                                client_id: this.clientId,
                                code: code,
                                code_verifier: codeVerifier,
                                redirect_uri: window.location.origin + window.location.pathname
                            })
                        });

                        const data = await response.json();

                        if (data.access_token) {
                            this.githubToken = data.access_token;
                            this.isAuthenticated = true;

                            // Store token with expiry (GitHub tokens are typically valid for 8 hours)
                            const expiry = Date.now() + (8 * 60 * 60 * 1000); // 8 hours
                            localStorage.setItem('slanglang-github-token', data.access_token);
                            localStorage.setItem('slanglang-github-token-expiry', expiry.toString());

                            this.updateAuthUI();

                            // Auto-generate if there's a pending prompt from before auth
                            if (this.pendingPrompt) {
                                const pendingPrompt = this.pendingPrompt;
                                this.pendingPrompt = null; // Clear it
                                // Small delay to let UI update first
                                setTimeout(() => this.generateCode(pendingPrompt), 500);
                            }
                        } else {
                            console.error('Failed to get access token:', data);
                            alert('Authentication failed. Please try again.');
                        }
                    } catch (error) {
                        console.error('Error exchanging code for token:', error);
                        alert('Authentication failed. Please try again.');
                    }
                }

                generateCodeVerifier() {
                    const array = new Uint8Array(32);
                    crypto.getRandomValues(array);
                    return btoa(String.fromCharCode(...array))
                        .replace(/\+/g, '-')
                        .replace(/\//g, '_')
                        .replace(/=/g, '');
                }

                async generateCodeChallenge(verifier) {
                    const encoder = new TextEncoder();
                    const data = encoder.encode(verifier);
                    const digest = await crypto.subtle.digest('SHA-256', data);
                    const array = new Uint8Array(digest);
                    return btoa(String.fromCharCode(...array))
                        .replace(/\+/g, '-')
                        .replace(/\//g, '_')
                        .replace(/=/g, '');
                }

                generateState() {
                    return btoa(crypto.getRandomValues(new Uint8Array(32)).toString())
                        .replace(/\+/g, '-')
                        .replace(/\//g, '_')
                        .replace(/=/g, '');
                }

                updateAuthUI() {
                    const authStatus = document.getElementById('authStatus');
                    const authBtn = document.getElementById('authBtn');
                    const promptInput = document.getElementById('aiPrompt');
                    const generateBtn = document.getElementById('generateBtn');
                    const authStatusContainer = document.querySelector('.ai-auth-status');

                    const isDevMode = window.SlangLangConfig?.DEV_MODE;
                    const isLocalDev = window.location.protocol === 'file:' ||
                                     window.location.hostname === 'localhost' ||
                                     window.location.hostname === '127.0.0.1';

                    if (isDevMode || isLocalDev) {
                        // Development mode - always allow AI generation with mock responses
                        authStatusContainer.style.display = 'block';
                        authStatus.textContent = 'Dev Mode';
                        authStatus.style.color = 'var(--blue)';
                        authBtn.style.display = 'none';
                        promptInput.disabled = false;
                        generateBtn.disabled = false;
                        generateBtn.textContent = 'Generate (Dev)';
                        this.hideUserAvatar();
                    } else if (this.isAuthenticated) {
                        // Authenticated - show user avatar next to send button
                        authStatusContainer.style.display = 'none';
                        promptInput.disabled = false;
                        generateBtn.disabled = false;
                        generateBtn.textContent = 'Send It';
                        this.showUserAvatar();
                    } else {
                        // Not authenticated - hide auth UI, will show modal on first Send It click
                        authStatusContainer.style.display = 'none';
                        promptInput.disabled = false;
                        generateBtn.disabled = false;
                        generateBtn.textContent = 'Send It';
                        this.hideUserAvatar();
                    }
                }

                async showUserAvatar() {
                    const userAvatar = document.getElementById('userAvatar');
                    const userAvatarImg = document.getElementById('userAvatarImg');

                    if (!this.githubToken) {
                        this.hideUserAvatar();
                        return;
                    }

                    try {
                        // Fetch user data from GitHub
                        const response = await fetch('https://api.github.com/user', {
                            headers: {
                                'Authorization': `Bearer ${this.githubToken}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });

                        if (response.ok) {
                            const userData = await response.json();
                            userAvatarImg.src = userData.avatar_url;
                            userAvatarImg.alt = `${userData.login}'s avatar`;
                            userAvatar.style.display = 'block';
                        } else {
                            // Fallback to default avatar if API call fails
                            userAvatarImg.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiMzMzMzMzMiLz4KPHBhdGggZD0iTTE2IDE0QzE4LjIxIDE0IDIwIDEyLjIxIDIwIDEwQzIwIDcuNzkgMTguMjEgNiAxNiA2QzEzLjc5IDYgMTIgNy43OSAxMiAxMEMxMiAxMi4yMSAxMy43OSAxNCAxNiAxNFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xNiAyMEMxMC4xMzYgMjAgOCAyNS44NjQgOCA0MEM4IDMwLjg2NCAxMC4xMzYgMzMgMTYgMzNDMjEuODY0IDMzIDI1IDMwLjg2NCAyNSA0QzI1IDI1Ljg2NCAyMi44NjQgMjAgMTYgMjBaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4=';
                            userAvatarImg.alt = 'Default user avatar';
                            userAvatar.style.display = 'block';
                        }
                    } catch (error) {
                        console.error('Failed to fetch user avatar:', error);
                        this.hideUserAvatar();
                    }
                }

                hideUserAvatar() {
                    const userAvatar = document.getElementById('userAvatar');
                    userAvatar.style.display = 'none';
                }

                signOut() {
                    // Clear authentication data
                    this.githubToken = null;
                    this.isAuthenticated = false;
                    localStorage.removeItem('slanglang-github-token');
                    localStorage.removeItem('slanglang-github-token-expiry');

                    // Update UI
                    this.updateAuthUI();

                    // Clear any cached user data
                    const userAvatarImg = document.getElementById('userAvatarImg');
                    userAvatarImg.src = '';
                }

                async generateCode(promptText = null) {
                    const prompt = promptText || document.getElementById('aiPrompt').value.trim();
                    if (!prompt) return;

                    const generateBtn = document.getElementById('generateBtn');
                    const originalText = generateBtn.textContent;

                    // Show loading state
                    generateBtn.innerHTML = '<div class="ai-loading"><div class="ai-spinner"></div>Generating...</div>';
                    generateBtn.disabled = true;

                    try {
                        const generatedCode = await this.callGitHubAI(prompt);

                        if (generatedCode) {
                            // Insert the generated code into the editor
                            editor.setValue(generatedCode);

                            // Clear the prompt
                            document.getElementById('aiPrompt').value = '';

                            // Auto-run the code
                            setTimeout(() => {
                                document.getElementById('runBtn').click();
                            }, 500);
                        }
                    } catch (error) {
                        console.error('Error generating code:', error);

                        let errorMessage = 'Failed to generate code. ';
                        if (error.message.includes('Not authenticated')) {
                            errorMessage += 'Please sign in with GitHub first.';
                        } else if (error.message.includes('401')) {
                            errorMessage += 'Authentication failed. Please sign in again.';
                        } else if (error.message.includes('403')) {
                            errorMessage += 'Access denied. You may not have permission to use GitHub Models.';
                        } else if (error.message.includes('429')) {
                            errorMessage += 'Rate limit exceeded. Please try again later.';
                        } else if (error.message.includes('500')) {
                            errorMessage += 'Server error. Please try again later.';
                        } else {
                            errorMessage += 'Please check your internet connection and try again.';
                        }

                        alert(errorMessage);
                    } finally {
                        // Restore button
                        generateBtn.textContent = originalText;
                        generateBtn.disabled = false;
                    }
                }

                async callGitHubAI(prompt) {
                    // Check for development mode
                    const isDevMode = window.SlangLangConfig?.DEV_MODE;
                    const isLocalDev = window.location.protocol === 'file:' ||
                                     window.location.hostname === 'localhost' ||
                                     window.location.hostname === '127.0.0.1';

                    if (isDevMode || isLocalDev) {
                        console.log('Using development mode - returning mock response');
                        return this.generateDevMockResponse(prompt);
                    }

                    if (!this.githubToken) {
                        throw new Error('Not authenticated');
                    }

                    const systemPrompt = `You are an expert programmer specializing in SlangLang, an Australian slang-inspired programming language.

SlangLang Language Specification:
${this.specContent || 'Specification not available'}

Your task is to generate valid SlangLang code based on user prompts. Follow these rules:
1. Use proper SlangLang syntax and keywords
2. Make code readable and follow the language's conversational style
3. Include comments to explain what the code does
4. Ensure the code is syntactically correct
5. Return ONLY the SlangLang code, no explanations or markdown formatting

Generate SlangLang code for the following request: ${prompt}`;

                    // Call GitHub Models API - no fallback
                    return await this.callGitHubModelsAPI(systemPrompt, prompt);
                }

                async callGitHubModelsAPI(systemPrompt, userPrompt) {
                    // GitHub Models API (preview feature)
                    // This is the expected format based on GitHub's documentation
                    const apiUrl = window.SlangLangConfig?.MODELS_API_URL || 'https://api.github.com/models/gpt-4o-mini/chat/completions';

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.githubToken}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            messages: [
                                {
                                    role: 'system',
                                    content: systemPrompt
                                },
                                {
                                    role: 'user',
                                    content: userPrompt
                                }
                            ],
                            max_tokens: 1000,
                            temperature: 0.7
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`GitHub Models API error: ${response.status} - ${errorData.message || response.statusText}`);
                    }

                    const data = await response.json();

                    if (data.choices && data.choices[0] && data.choices[0].message) {
                        return data.choices[0].message.content.trim();
                    }

                    throw new Error('Unexpected response format from GitHub Models API');
                }

                generateDevMockResponse(prompt) {
                    // Development mode mock responses - clearly marked as dev mode
                    const prompt_lower = prompt.toLowerCase();

                    let response = `oi [DEV MODE] generated response for: "${prompt}"
oi This is a mock response for development/testing
oi Real AI responses only work with GitHub OAuth

`;

                    if (prompt_lower.includes('fibonacci')) {
                        response += `fibonacci on the barbie with n:
  if n cops 2,
    serve 1
  otherwise,
    serve howbout fibonacci with n minus 1 plus howbout fibonacci with n minus 2
  make tracks.

oi test the fibonacci function
Crikey! bloody Fibonacci sequence: mate.
pass the i, 10!
  Crikey! i plus " -> " plus howbout fibonacci with i
who's got it?`;
                    } else if (prompt_lower.includes('sort') && prompt_lower.includes('list')) {
                        response += `bubble sort on the barbie with numbers:
  pass the i, flamin length of numbers!
    pass the j, flamin length of numbers minus i minus 1!
      if grab j from numbers tops grab j plus 1 from numbers,
        numbers is howbout swap with numbers, j, j plus 1
      make tracks.
    who's got it?
  who's got it?
  serve numbers
fair go.

oi test the sort
unsorted is esky: 64, 34, 25, 12, 22, 11, 90.
Crikey! bloody Before sorting: mate.
Crikey! unsorted
sorted is howbout bubble sort with unsorted
Crikey! bloody After sorting: mate.
Crikey! sorted`;
                    } else {
                        response += `Crikey! bloody Hello from development mode! mate.
Crikey! "You asked for: ${prompt}"

oi This is just a mock response for testing.
oi To get real AI responses, deploy and use GitHub OAuth.`;
                    }

                    return response;
                }

            }

            // Initialize AI Generator
            const aiGenerator = new AIGenerator();

        </script>
    </body>
    </html>
    